window.ChatWidget = undefined;
"use strict";var ChatWidgetModule=(()=>{var h=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var C=(n,t)=>{for(var e in t)h(n,e,{get:t[e],enumerable:!0})},D=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of M(t))!R.call(n,i)&&i!==e&&h(n,i,{get:()=>t[i],enumerable:!(s=S(t,i))||s.enumerable});return n};var P=n=>D(h({},"__esModule",{value:!0}),n);var z={};C(z,{default:()=>W});function L(){return new Promise((n,t)=>{let e=0,s=100,i=()=>{e++,console.log("Checking dependencies...",{react:!!window.React,reactDom:!!window.ReactDOM,pusher:!!window.Pusher}),window.React&&window.ReactDOM&&window.Pusher?n():e>=s?t(new Error("Dependencies failed to load")):setTimeout(i,100)};i()})}async function T(n,t){if(!n)throw new Error("Website ID is required");console.log("Creating widget for website:",n);let e=window.React,{useState:s,useEffect:i}=e,E=window.ReactDOM,v=window.Pusher;function x({websiteId:l,baseUrl:k}){let[d,f]=s(!1),[N,b]=s([]),[u,y]=s(""),[m]=s(()=>{let o=localStorage.getItem("visitorId");if(o)return o;let r=Math.random().toString(36).substring(7);return localStorage.setItem("visitorId",r),r});i(()=>{if(!d)return;let r=new v("f11ba8ab791471986ab2",{cluster:"eu"}).subscribe(`chat-${l}`);return r.bind("message",a=>{a.visitorId!==m&&b(w=>[...w,a])}),()=>{r.unbind_all(),r.unsubscribe()}},[d,l,m]);let I=async o=>{if(o.preventDefault(),!!u.trim())try{let r=await fetch(`${k}/api/widget/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:u,websiteId:l,visitorId:m})});if(!r.ok)throw new Error("Failed to send message");let a=await r.json();b(w=>[...w,a]),y("")}catch(r){console.error("Error sending message:",r)}};return e.createElement("div",{className:"fixed bottom-4 right-4 z-50"},d?e.createElement("div",{className:"bg-white rounded-lg shadow-xl w-96 h-[500px] flex flex-col"},[e.createElement("div",{key:"header",className:"p-4 border-b bg-blue-500 text-white rounded-t-lg flex justify-between items-center"},[e.createElement("h3",{key:"title",className:"font-medium"},"Chat Support"),e.createElement("button",{key:"close",onClick:()=>f(!1),className:"text-white hover:text-gray-200"},e.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))]),e.createElement("div",{key:"messages",className:"flex-1 p-4 overflow-y-auto space-y-4"},N.map(o=>e.createElement("div",{key:o.id,className:`flex ${o.senderType==="VISITOR"?"justify-end":"justify-start"}`},e.createElement("div",{className:`max-w-[70%] rounded-lg p-3 ${o.senderType==="VISITOR"?"bg-blue-500 text-white":"bg-gray-100"}`},o.content)))),e.createElement("form",{key:"form",onSubmit:I,className:"p-4 border-t"},e.createElement("div",{className:"flex space-x-2"},[e.createElement("input",{key:"input",type:"text",value:u,onChange:o=>y(o.target.value),placeholder:"Type a message...",className:"flex-1 rounded-lg border p-2 focus:outline-none focus:border-blue-500"}),e.createElement("button",{key:"submit",type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"},"Send")]))]):e.createElement("button",{onClick:()=>f(!0),className:"bg-blue-500 text-white p-4 rounded-full shadow-lg hover:bg-blue-600 transition-colors"},e.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-4l-4 4z"}))))}let p=document.createElement("div");document.body.appendChild(p);let c=document.createElement("link");c.rel="stylesheet",c.href=`${t}/widget.css`,document.head.appendChild(c),E.render(e.createElement(e.StrictMode,null,e.createElement(x,{websiteId:n,baseUrl:t})),p)}var g=class{constructor(){this.isInitialized=!1}async init(){try{if(this.isInitialized){console.log("Chat widget already initialized");return}console.log("Initializing chat widget...");let t=document.currentScript||document.querySelector("script[data-website-id]"),e=t?.getAttribute("data-website-id"),s=t?.src?new URL(t.src).origin:"";if(!e)throw new Error("Widget: Missing website ID");if(!s)throw new Error("Widget: Could not determine base URL");console.log("Found website ID:",e),console.log("Base URL:",s),await L(),console.log("Dependencies loaded successfully"),await T(e,s),console.log("Widget created successfully"),this.isInitialized=!0}catch(t){throw console.error("Widget initialization error:",t),t}}},O=new g,W=O;return P(z);})();
window.ChatWidget = ChatWidgetModule.default;
